"use strict";$.widget("tompit.tpIde",{options:{selection:{explorerNode:null,view:null},designer:{active:null,errorListState:{error:!0,warning:!0,info:!0}},globalization:{language:null},properties:{saveMode:"instant",state:[],title:document.title},state:[],navigation:{index:0,views:[]}},_create:function(){this.initialize()},initialize:function(){this.initializeExplorer();this.setErrors();var instance=this;$(document).keyup(function(e){e.ctrlKey&&e.altKey&&e.keyCode===37?instance._previousView():e.ctrlKey&&e.altKey&&e.keyCode===39&&instance._nextView()});$("#devStatusErrors").click(function(){instance.showDevErrors()});$("#ideErrors").blur(function(){$(this).removeAttr("tabindex");$(this).collapse("hide")})},setLanguage:function(value){this.options.globalization.language=value},setState:function(property,value){var exists=!1;$.each(this.options.state,function(i,v){if(v.property===property)return v.value=value,exists=!0,!1});exists||this.options.state.push({property:property,value:value})},getState:function(property){var r=null;return $.each(this.options.state,function(i,v){if(v.property===property)return r=v.value,!1}),r},initializeExplorer:function(e){var instance=this;this._initializeExplorerNodes(e);$("#exBtnCollapse").unbind("click");$("#exBtnPreviousView").unbind("click");$("#exBtnNextView").unbind("click");$("#exBtnCollapse").click(function(){var nodes=$('[data-kind="explorer-node"]'),root,firstLevel;$.each(nodes,function(i,v){var icon=$(v).find("span [data-fa-i2svg]"),group;icon.removeClass("fa-chevron-down").addClass("fa-chevron-right");group=$(v).children('[data-kind="explorer-group"][data-group]');group.addClass("collapse")});root=$("#devExplorerNodes");firstLevel=root.children('[data-kind="explorer-node"]');firstLevel.length===0?instance.selectNode(null):instance.selectNode({path:firstLevel.attr("data-id")})});$("#exBtnPreviousView").click(function(){instance._previousView()});$("#exBtnNextView").click(function(){instance._nextView()});instance._syncNavigationButtons()},_previousView:function(){this.options.navigation.index<=0||(this.options.navigation.index--,this.selectNode({path:this.options.navigation.views[this.options.navigation.index].path,reorderNavigation:!1,stateIndex:this.options.navigation.index+1}),this._syncNavigationButtons())},_nextView:function(){this.options.navigation.index>=this.options.navigation.views.length-1||(this.options.navigation.index++,this.selectNode({path:this.options.navigation.views[this.options.navigation.index].path,reorderNavigation:!1,stateIndex:this.options.navigation.index-1}),this._syncNavigationButtons())},_initializeExplorerNodes:function(e){var d,container,instance,draggables,droppables;e=$.extend({selector:null,path:null,mode:"children"},e);d=null;e.selector===null?d=this.element:(container=null,e.path!==null&&(container=this._findElement(e.path)),d=container===null?e.selector:e.mode==="children"?$(e.selector,container):container);instance=this;$('[data-kind="toggler"]',d).click(function(){var target=$(this),icon=target.find("[data-fa-i2svg]"),node=target.closest("[data-id]"),id=node.attr("data-id"),path=instance._resolvePath(target),group,loaded;icon.toggleClass("fa-chevron-right").toggleClass("fa-chevron-down");group=node.children('[data-kind="explorer-group"][data-group]');icon.hasClass("fa-chevron-down")?(group.removeClass("collapse"),loaded=group.attr("data-loaded"),loaded!=="true"&&instance._loadExplorerChildren({path:path})):group.addClass("collapse")});$(".dev-explorer-node-text",d).click(function(e){if(e.ctrlKey){var url=new tompit.devUrl,path=instance._resolvePath($(this));window.open(url.environment()+"?path="+path,"_blank");return}instance.selectNode({target:$(this),scroll:!1})});draggables=$('[data-kind="explorer-node"][data-static="false"]',d.parent());$.each(draggables,function(i,v){$(v).data("draggable")&&$(v).draggable("destroy")});droppables=$('[data-kind="explorer-node"][data-container="true"]',d.parent());$.each(droppables,function(i,v){$(v).data("droppable")&&$(v).droppable("destroy")});$('[data-kind="explorer-node"][data-static="false"]',d.parent()).draggable({containment:"#devExplorerNodes",scroll:!0,scrollSpeed:100,cursor:"move",opacity:.7,revert:!0,revertDuration:0,create:function(){instance.options.selection.dragPath=instance._resolvePath($(this));$(this).attr("origin",$(this).closest('[data-container="true"]').attr("data-id"))}});$('[data-kind="explorer-node"][data-container="true"]',d.parent()).droppable({greedy:!0,accept:function(){var att=$(this).attr("data-container");return att===null?!1:att==="true"},drop:function(event,ui){var folder=$(this).attr("data-id"),id=ui.draggable.attr("data-id"),origin=ui.draggable.attr("origin"),path=instance.options.selection.dragPath;origin!==folder&&ide.ideAction({data:{action:"move",id:id,folder:folder,path:path},onComplete:function(){var originTarget;origin!==null&&(originTarget=$('[data-kind="explorer-node"][data-id="'+origin+'"]'));var target=$('[data-kind="explorer-node"][data-id="'+folder+'"]'),originPath=instance._resolvePath(originTarget),targetPath=instance._resolvePath(target);originPath.indexOf("/")>-1&&(originPath=originPath.substr(0,originPath.lastIndexOf("/")));instance.refreshExplorer({path:originPath,mode:"item"});$(this).remove();instance.refreshExplorer({path:targetPath,mode:"item"})}})}})},selectNode:function(e){var path,existingIndex,en,reorderNavigation,existingState;if(e=$.extend({target:null,path:null,scroll:!0,stateIndex:this.options.navigation.index},e),e.target===null&&e.path!==null&&(e.target=this._findElement(e.path)),path=this._resolvePath(e.target),path!==this.options.selection.explorerNode||typeof e.force!="undefined"&&e.force!==!1){this.unloadDesigner(e);this.options.selection.explorerNode=path;this.draw();this.loadSection({section:"designer"});this.setSelection();document.title=e.target.find('span[data-kind="documentName"]').html()+" ("+this.options.properties.title+")";e.scroll&&this.scrollToNode(e);typeof this.options.selection.explorerNode!="undefined"&&this.options.selection.explorerNode!==null&&this.options.selection.explorerNode.length>0&&(existingIndex=-1,en=this.options.selection.explorerNode,$.each(this.options.navigation.views,function(i,v){if(v.path===en)return existingIndex=i,!1}),existingIndex===-1?(this.options.navigation.views.push({path:en}),this.options.navigation.views.length>25&&this.options.navigation.views.shift(),this.options.navigation.index=Math.max(0,this.options.navigation.views.length-1)):(reorderNavigation=!0,typeof e.reorderNavigation!="undefined"&&(reorderNavigation=e.reorderNavigation),reorderNavigation?(existingState=this.options.navigation.views[existingIndex].state,this.options.navigation.views.splice(existingIndex,1),this.options.navigation.views.push({path:en,state:existingState}),this.options.navigation.index=Math.max(0,this.options.navigation.views.length-1)):this.options.navigation.index=existingIndex),this._syncNavigationButtons());let ce=new CustomEvent("selectionChanged");this.element[0].dispatchEvent(ce)}},_syncNode:function(s,e){var element=s._findElement(e.target);s.options.selection.explorerNode=this._resolvePath(element);s.draw();s.loadSection({section:"designer"});this.setSelection();e.scroll&&$("#devExplorer").animate({scrollTop:element.offset().top},1e3)},scrollToNode:function(e){$("#devExplorer").animate({scrollTop:e.target.offset().top},1e3)},setSelection:function(path){this.loadSection({section:"selection",path:path})},refreshExplorer:function(e){this._loadExplorerChildren(e)},expandCurrent:function(){this.expand({path:this.options.selection.explorerNode})},collapseCurrent:function(){var element=this._findElement(this.options.selection.explorerNode),icon,group;element!==null&&(icon=element.children(".dev-explorer-node-content").find("span [data-fa-i2svg]"),icon.length!==0)&&(icon.removeClass("fa-chevron-down").addClass("fa-chevron-right"),group=element.children('[data-kind="explorer-group"][data-group]'),group.addClass("collapse"))},selectNext:function(){var element=this._findElement(this.options.selection.explorerNode),group=element.children('[data-kind="explorer-group"][data-group]'),path,next,p,parentNode,sibling,spath;if(group.length>0&&!group.hasClass("collapse")&&group.children().length>0)path=this._resolvePath($('[data-kind="explorer-node"]',group)),this.selectNode({target:this._findElement(path)});else if(next=element.next(),next.length>0)p=this._resolvePath(next),this.selectNode({target:this._findElement(p)});else for(parentNode=element.parent().closest('[data-kind="explorer-node"]'),sibling=null;sibling===null||sibling.length===0;){if(parentNode.length===0)return;if(sibling=parentNode.next(),sibling.length===0)parentNode=parentNode.parent().closest('[data-kind="explorer-node"]');else{spath=this._resolvePath(sibling);this.selectNode({target:this._findElement(spath)});return}}},selectPrevious:function(){var element=this._findElement(this.options.selection.explorerNode),prevSibling,group,nested,nestedGroup,last;if(element.length!==0)if(prevSibling=element.prev(),prevSibling.length===0){if(prevSibling=element.parent().closest('[data-kind="explorer-node"]'),prevSibling.length===0)return;this.selectNode({target:this._findElement(this._resolvePath(prevSibling))})}else{for(group=prevSibling.children('[data-kind="explorer-group"]');group.length>0&&!group.hasClass("collapse")&&group.children().length>0;)if(nested=group.children('[data-kind="explorer-node"]'),nested.length>0)if(nestedGroup=nested.last().children('[data-kind="explorer-group"]'),nestedGroup.length>0&&!nestedGroup.hasClass("collapse")&&nestedGroup.children().length>0)group=nestedGroup;else break;else break;group.length>0?(last=group.children('[data-kind="explorer-node"]').last(),this.selectNode({target:this._findElement(this._resolvePath(last))})):this.selectNode({target:this._findElement(this._resolvePath(prevSibling))})}},expand:function(e){var element,icon,group,loaded;(e=$.extend({path:null,onComplete:function(){return!1}},e),element=this._findElement(e.path),element.length!==0)&&(icon=element.children(".dev-explorer-node-content").find("span [data-fa-i2svg]"),icon.removeClass("fa-chevron-right").addClass("fa-chevron-down"),group=element.children('[data-kind="explorer-group"][data-group]'),group.removeClass("collapse"),loaded=group.attr("data-loaded"),loaded!=="true"?this._loadExplorerChildren({path:e.path,onComplete:e.onComplete}):e.onComplete())},expandTo:function(e){var tokens,instance,currentTokens,i,fullPath,target,current;if(e=$.extend({path:null,select:!0,selectedId:null,current:null},e),tokens=e.path.split("/"),instance=this,e.current!==null){for(currentTokens=e.current.split("/"),i=0;i<currentTokens.length;i++)tokens.shift();if(tokens.length===0){e.select&&(fullPath=e.path,e.selectedId!==null&&e.selectedId.length>0&&(fullPath+="/"+e.selectedId),target=this._findElement(fullPath),this.selectNode({target:target}));typeof e.onComplete!="undefined"&&e.onComplete();return}current=e.current+"/"+tokens.shift()}else current=tokens.shift();instance.expand({path:current,onComplete:function(){instance.expandTo({path:e.path,select:e.select,selectedId:e.selectedId,current:current,onComplete:e.onComplete})}})},_checkSelection:function(e){if(this.options.selection.explorerNode!==null){var target=this._findElement(this.options.selection.explorerNode);target.length===0?(this.options.selection.explorerNode=this.options.selection.explorerNode.substr(0,this.options.selection.explorerNode.lastIndexOf("/")),this._checkSelection({select:!0})):e.select&&this.selectNode({target:target,force:!0})}},_loadExplorerChildren:function(e){var url=new tompit.devUrl,instance=this;e=$.extend({onComplete:function(){return!1},select:!1,async:!0,depth:0,mode:"children"},e);tompit.post({url:url.environment("dom"),contentType:"application/json; charset=utf-8",dataType:"json",async:e.async,data:{path:e.path,depth:e.depth,mode:e.mode,language:instance.options.globalization.language},progress:tompit.findProgress(this.element),onSuccess:function(data,request){var id=e.path.substr(e.path.lastIndexOf("/")+1),s=null,target,group,target1;e.mode==="children"?(target=instance._findElement(e.path),s='[data-kind="explorer-group"][data-group="'+id+'"]',group=target.children(s),group.attr("data-loaded","true"),group.html(data)):(target1=instance._findElement(e.path),s='[data-kind="explorer-node"][data-id="'+id+'"]',$(target1).replaceWith(data));instance._initializeExplorerNodes({selector:s,path:e.path,mode:e.mode});instance.draw();e.select&&instance.expandTo({path:e.path,select:!0});instance._checkSelection({select:!1});e.onComplete(data,request)}})},draw:function(){if($(".dev-explorer-node-content.active",this.element).removeClass("active"),this.options.selection.explorerNode!==null){var selected=this._findElement(this.options.selection.explorerNode);selected.children(".dev-explorer-node-content").addClass("active")}},saveProperty:function(options){var exists;if(this.options.properties.saveMode==="batch"){exists=!1;$.each(this.options.properties.state,function(i,v){if(v.property===options.data.property)return v.value=options.data.value,exists=!0,!1});exists||this.options.properties.state.push({property:options.data.property,value:options.data.value});return}var url=new tompit.devUrl,instance=this,data=$.extend({language:this.options.globalization.language,selectionId:this.options.selection.id,designerSelectionId:this.options.selection.designerId},options.data);tompit.post({url:url.environment("save"),contentType:"application/json; charset=utf-8",dataType:"json",data:data,progress:tompit.findProgress(this.element),onError:function(request,status,error){if(typeof options.onError!="undefined")return options.onError(request,status,error)},onSuccess:function(data,status,request){var result,invalidate,path,designerPath;if(typeof options.onComplete!="undefined")options.onComplete(data,request);result=request.getResponseHeader("result");result!==null&&result==="1"?instance.statusText('<span class="text-info"><i class="fal fa-check-circle"><\/i> \''+options.data.property+"' saved.<\/span>"):tompit.warning("Property has not been saved. This is possibly due to the not supported server implementation.","Save");invalidate=request.getResponseHeader("invalidate");invalidate!==null&&(path=request.getResponseHeader("path"),designerPath=request.getResponseHeader("designerPath"),instance.refreshSections({sections:invalidate,path:path,designerPath:designerPath}));instance.options.designer.active!==null&&$.isFunction(instance.options.designer.active.idePropertySaved)&&instance.options.designer.active.idePropertySaved(data)}})},refreshDesigner:function(){var data={path:this.selectedPath(),sections:"designer"};this.refreshSections(data)},refreshSections:function(e){var sec=e.sections.toLowerCase().split(",").map(function(item){return item.trim()}),explorer=sec.indexOf("explorer")>-1,designer=sec.indexOf("designer")>-1,selection=sec.indexOf("selection")>-1,properties=sec.indexOf("properties")>-1,events=sec.indexOf("events")>-1,toolbox=sec.indexOf("toolbox")>-1,property=sec.indexOf("property")>-1,errorList=sec.indexOf("errorlist")>-1,all=sec.indexOf("all")>-1,path,depth;all?this.loadSection({section:"all",path:e.path,data:e.data,onComplete:e.onComplete}):(explorer&&(path=e.path,depth=0,typeof e.explorerPath!="undefined"&&(path=e.explorerPath,1),this.refreshExplorer({path:path,depth:depth,mode:"item",onComplete:e.onComplete})),designer&&this.loadSection({section:"designer",path:e.path,data:e.data,onComplete:e.onComplete}),selection?this.loadSection({section:"selection",path:e.path,data:e.data,onComplete:e.onComplete}):(properties?this.loadSection({section:"properties",path:e.path,data:e.data,onComplete:e.onComplete}):property&&this.loadSection({section:"property",path:e.path,data:e.data,onComplete:e.onComplete}),events&&this.loadSection({section:"events",path:e.path,data:e.data,onComplete:e.onComplete}),toolbox&&this.loadSection({section:"toolbox",path:e.path,data:e.data,onComplete:e.onComplete}),errorList&&this.loadSection({section:"errorList",path:e.path,data:e.data,onComplete:e.onComplete})))},clearDescription:function(){$("#devPropertyDescription").empty()},setDescription:function(title,description){$("#devPropertyDescription").html("<strong>"+title+"<\/strong><br/>"+description)},setSelectionId:function(id){this.options.selection.id=id},setDesignerSelectionId:function(id){this.options.selection.designerId=id},statusText:function(html){$("#devStatusText").html(html)},setErrors:function(errors){if(typeof errors=="undefined"||errors.length===0)$("#devStatusErrors").html('<i class="fal fa-check-circle text-success"><\/i><span class="px-2">0<\/span>'),$("#devStatusErrors").attr("data-count",0),$("#devStatusErrors").removeClass("clickable");else{$("#devStatusErrors").html('<i class="fal fa-times-circle text-danger"><\/i><span class="px-2">'+errors.length+"<\/span>");$("#devStatusErrors").attr("data-count",errors.length);$("#devStatusErrors").addClass("clickable");var list=$('<ul class="list-unstyled">');$.each(errors,function(i,v){list.append($("<li>").append('<div class ="row"><div class="col-md-10">'+v.message+'<\/div><div class="col-md-2">'+v.source+"<\/div><\/div>"))});$("#ideErrors").html(list)}},showDevErrors:function(){var att=$("#devStatusErrors").attr("data-count");att!==null&&att!=="0"&&($("#ideErrors").attr("tabindex",0),$("#ideErrors").collapse("show"),$("#ideErrors").focus())},loadSection:function(e){var url=new tompit.devUrl,instance=this,data;e=$.extend({section:null,path:null,data:null},e);e.path===null&&(e.path=this.selectedPath());data=$.extend(e.data,{path:e.path,section:e.section,language:instance.options.globalization.language});tompit.post({url:url.environment("Section"),contentType:"application/json; charset=utf-8",dataType:"json",data:data,progress:tompit.findProgress(this.element),onSuccess:function(data,status,request){var s=request.getResponseHeader("section").toLowerCase();if(s==="all"?($("#ide").html(data),instance.initialize()):s==="explorer"?($("#devExplorerNodes").html(data),instance.initializeExplorer()):s==="selection"?$("#devSelection").html(data):s==="properties"?$("#devTabPropertyGrid").html(data):s==="events"?$("#devTabEvents").html(data):s==="toolbox"?$("#devTabToolbox").html(data):s==="property"||(s==="errorlist"?$("#devTabErrorList").html(data):s==="designer"&&($("#ide").off("toolbarClick"),$("#devDesigner").html(data),instance.initializeDesigner())),$.isFunction(e.onComplete))e.onComplete(data,request)}})},selectedPath:function(){var e=this.selectedElement();return e===null||e.length===0?null:this._resolvePath(e)},selectedElement:function(){return this.options.selection.explorerNode===null?null:this._findElement(this.options.selection.explorerNode)},initializeDesigner:function(){var instance=this,state,isText;if($('[data-tp-tag="toolbar-action"]',this.element).click(function(){var e={id:$(this).attr("data-id"),cancel:!1,kind:$(this).attr("data-toolbar-kind"),parameters:{}};instance.element.trigger("toolbarClick",e);e.cancel||instance.designerAction({data:$.extend(e.parameters,{action:e.id})})}),tompit.initContainer("#devDesigner"),this.options.designer.active!==null){if(state=this.options.navigation.views[this.options.navigation.index].state,typeof state!="undefined"&&state!==null&&$.isFunction(this.options.designer.active.onLoadState))this.options.designer.active.onLoadState(state);$.isFunction(this.options.designer.active.isTextDesigner)&&(isText=this.options.designer.active.isTextDesigner(),isText?($("#devTextDesigner").collapse("show"),$("#devDesigner").collapse("hide")):($("#devTextDesigner").collapse("hide"),$("#devDesigner").collapse("show")))}else $("#devTextDesigner").collapse("hide"),$("#devDesigner").collapse("show")},showDesigner:function(){$("#devTextDesigner").collapse("hide");$("#devDesigner").collapse("show")},setPropertySaveMode:function(v){this.options.properties.saveMode=v;this.options.properties.state=[]},getPropertiesState:function(){return this.options.properties.state},elementId:function(target){return $(target).closest("[data-id]").attr("data-id")},unloadDesigner:function(e){(this.setErrors(),this.options.designer.active!==null)&&(typeof e.stateIndex!="undefined"&&$.isFunction(this.options.designer.active.onSaveState)&&(this.options.navigation.views[e.stateIndex].state=this.options.designer.active.onSaveState()),$.isFunction(this.options.designer.active.onUnload)&&this.options.designer.active.onUnload(),this.options.designer.active=null)},setActiveDesigner:function(d){this.options.designer.active=d},designerAction:function(d,progress){return this._action(d,progress,"action")},ideAction:function(d,progress){return this._action(d,progress,"ide")},_action:function(d,progress,action){var url=new tompit.devUrl,instance=this,path=this.selectedPath();return typeof d!="undefined"&&typeof d.data!="undefined"&&typeof d.data.path!="undefined"&&(path=d.data.path),tompit.post({url:url.environment(action),contentType:"application/json; charset=utf-8",dataType:"json",data:$.extend(d.data,{path:path,language:instance.options.globalization.language}),progress:typeof progress=="undefined"||progress?tompit.findProgress(this.element):null,onError:d.onError,onSuccess:function(data,status,request){var type=request.getResponseHeader("designerResult");if(instance._handleMessage(request),type===null){if(typeof d.onComplete!="undefined")d.onComplete(data,request);return}if(type==="partial"){if(typeof d.onComplete!="undefined")d.onComplete(data,request)}else if(type==="json"){if(typeof d.onComplete!="undefined")d.onComplete(JSON.parse(data),request)}else if(type==="section"){var designerPath=request.getResponseHeader("designerPath"),path=request.getResponseHeader("path"),sections=request.getResponseHeader("invalidate");sections!==null&&instance.refreshSections({sections:sections,path:path,explorerPath:designerPath,designerPath:designerPath,data:data,onComplete:function(){if($.isFunction(d.onComplete))d.onComplete(data,request)}})}}})},_handleMessage:function(request){var kind=request.getResponseHeader("messageKind"),title,message,explorerPath,instance,options;kind!==null&&(title=request.getResponseHeader("title"),message=request.getResponseHeader("message"),title!==null||message!==null)&&(kind=kind.toLowerCase(),explorerPath=request.getResponseHeader("explorerPath"),instance=this,toastr.clear(),options={timeOut:2500},explorerPath!==null&&(options.onclick=function(){instance.expandTo({path:explorerPath})}),kind==="primary"||kind==="information"||kind==="secondary"?tompit.info(message,title,options):kind==="success"?tompit.success(message,title,options):kind==="warning"?tompit.warning(message,title,options):kind==="danger"&&tompit.danger(message,title,options))},_resolvePath:function(element){for(var path=[],current=element.closest("[data-id]");current.length>0;)path.push(current.attr("data-id")),current=current.parent().closest("[data-id]");return path.reverse().join("/")},_findElement:function(path){for(var container,tokens=path.split("/"),current=null,i=0;i<tokens.length;i++)container=current,container===null&&(container=$("#devExplorerNodes")),current=$('[data-kind="explorer-node"][data-id="'+tokens[i]+'"]',container).first();return current},_syncNavigationButtons:function(){$("#exBtnPreviousView").prop("disabled",this.options.navigation.index===0);$("#exBtnNextView").prop("disabled",this.options.navigation.index>=this.options.navigation.views.length-1)},hideToolbar:function(){$("#devToolbar").addClass("collapse")},showToolbar:function(){$("#devToolbar").removeClass("collapse")},setSelectionView:function(value){this.options.selection.view=value},getSelectionView:function(){return this.options.selection.view},newWindow:function(){}});tompit.DEVDEFAULTS={environmentUrl:null};tompit.DEVGLOBALIZE={environmentUrlNotSet:null};tompit.devUrl=function(){this.environment=function(verb){return(tompit.DEVDEFAULTS.environmentUrl===null&&tompit.clientError(tompit.DEVGLOBALIZE.environmentUrlNotSet),typeof verb=="undefined")?tompit.DEVDEFAULTS.environmentUrl:tompit.DEVDEFAULTS.environmentUrl==="/"?tompit.DEVDEFAULTS.environmentUrl+verb:tompit.DEVDEFAULTS.environmentUrl+"/"+verb}},function($){$.widget("tompit.tpTextEditor",{options:{instance:null,state:[],languages:[],colors:[{ms:null,color:"transparent"},{ms:null,color:"#e1f5fe"},{ms:null,color:"#e8f5e9"},{ms:null,color:"#fbe9e7"},{ms:null,color:"#ede7f6"},{ms:null,color:"#eceff1"},{ms:null,color:"#efebe9"},{ms:null,color:"#fff8e1"},{ms:null,color:"#fce4ec"},{ms:null,color:"#e0f7fa"},{ms:null,color:"#fffde7"}],decorations:[]},_create:function(){var target=this;let tabs=document.querySelector("#modelTabs");tabs!==null&&(tabs.addEventListener("click",e=>{e.preventDefault();e.stopPropagation();var t=e.target.closest("[data-model]");t!==null&&target.activateModel(t.getAttribute("data-model"))}),tabs.addEventListener("dblclick",e=>{e.preventDefault();e.stopPropagation();var t=e.target.closest("[data-model]");t!==null&&target.closeModel(t.getAttribute("data-model"))}));require(["vs/editor/editor.main"],function(){var editor,editorOpts;monaco.editor.setTheme("vs");editor=$('[data-role="text-editor"]',$(target.element));editor.length||console.warn("Editor container not found.");editorOpts={language:null,value:null,lineNumbers:!0,scrollBeyondLastLine:!0,automaticLayout:!0,fontSize:"14px",autoClosingBrackets:"beforeWhitespace",autoClosingOvertype:"always",autoClosingQuotes:"beforeWhitespace",autoIndent:"brackets",colorDecorators:!0,fixedOverflowWidgets:!0,folding:!0,formatOnPaste:!0,formatOnType:!0,glyphMargin:!0,lineNumbersMinChars:4,layoutInfo:{heigth:"100%"},parameterHints:{enabled:!0},wrappingColumn:0,wrappingIndent:"indent",showUnused:!0,wordWrap:"off",tabCompletion:"on",model:null,minimap:{enabled:!1}};target.options.language&&(editorOpts.language=target.options.language);target.options.source&&(editorOpts.value=target.options.source.join("\n"),editorOpts.model=undefined);target.options.instance=monaco.editor.create(editor[0],editorOpts,{textModelService:{createModelReference:uri=>new Promise(resolve=>{var result={uri:uri,load:()=>Promise.resolve(textEditorModel),dispose:()=>{},textEditorModel:null};result.textEditorModel=monaco.editor.getModel(uri);result.textEditorModel===null?ide.designerAction({data:{action:"loadModel",model:{uri:uri.toString()}},onComplete:e=>{result.textEditorModel=monaco.editor.createModel(e.text,e.language,uri.toString()),result.textEditorModel.fileName=e.fileName,result.textEditorModel.microService=e.microService,textEditorState.isLanguageInitialized(e.language)||textEditorState.initializeLanguage(e.language,{codeAction:e.codeAction,completionItem:e.codeCompletion,declaration:e.declaration,definition:e.definition,signatureHelp:e.signatureHelp,documentSymbol:e.documentSymbol,documentFormatting:e.documentFormatting}),resolve({object:result,dispose:()=>{}})}}):resolve({object:result,dispose:()=>{}})})}});const editorService=target.options.instance._codeEditorService,openEditorBase=editorService.openCodeEditor.bind(editorService);editorService.openCodeEditor=(input,source)=>new Promise(resolve=>{openEditorBase(input,source).then(result=>{if(result===null){let model=monaco.editor.getModel(input.resource);model!==null&&(source.setModel(model),target.activateModel(model.id,model.fileName,model.microService))}resolve(result)})});target.options.instance.setup=function(options){var debug=options.debug,debugButton=$("#btnDebug");if($("#customActions").empty(),options.actions){for(let i=0;i<options.actions.length;i++){const action=options.actions[i];$("#customActions").append(`<a href="#" class="btn btn-sm btn-light" title="${action.text}" data-tag="custom-action" data-action="${action.action}"><i class="${action.glyph}"></i></a>`)}$('a[data-tag="custom-action"]').click(e=>{var target=$(e.target).closest("a");ide.designerAction({data:{action:target.attr("data-action")},onComplete:()=>{tompit.success("Entity synchronized")}})})}typeof debug!="undefined"&&typeof debug.url!="undefined"&&debug.url.length>0?(debugButton.collapse("show"),debugButton.attr("href",debug.url)):debugButton.collapse("hide");typeof options.language=="undefined"||options.length===0?$("#labelSyntaxLanguage").collapse("hide"):($("#labelSyntaxLanguage").html(options.language),$("#labelSyntaxLanguage").collapse("show"))};monaco.editor.onDidCreateModel(model=>{model.onDidChangeContent(e=>{try{target.setState({model:model.uri.toString(),dirty:!0,timestamp:Date.now()})}catch(e){console.log(e)}})});if($.isFunction(target.options.onCreated))target.options.onCreated(target,target.getInstance())})},getDirtyModels:function(){var result=[];return $.each(this.options.state,function(i,v){if(v.dirty){var elapsed=Date.now()-v.timestamp,isTyping=elapsed<750;isTyping||(result.push(v),v.timestamp=Date.now(),v.dirty=!1)}}),result},loadDecorations:function(e){ide.designerAction({data:{action:"deltaDecorations",model:{uri:e.model.uri.toString(),id:e.model.id},text:e.model.getValue()},onComplete:d=>{this.setDecorations({model:e.model,decorations:d})}})},setDecorations:function(e){var existing=null,decorations=this.options.decorations;if(decorations)for(let i=0;i<decorations.length;i++){let decoration=decorations[i];if(decoration.id===e.model.id){existing=decoration;break}}var existingDecorations=existing&&existing.decorations||[],newDecorations=e.decorations||[],result=e.model.deltaDecorations(existingDecorations,newDecorations);existing?existing.decorations=result:decorations.push({id:e.model.id,decorations:result})},setState:function(state){var existingState=null,existingStateIndex=-1;if($.each(this.options.state,function(i,v){if(v.model===state.model)return existingState=v,existingStateIndex=i,!1}),existingState===null){if(!state.dirty)return;this.options.state.push(state)}else existingState.dirty?(existingState.dirty=!0,existingState.timestamp=Date.now()):this.options.state.splice(existingStateIndex,1)},getInstance:function(){return this.options.instance},isLanguageInitialized:function(language){var result=!1;return $.each(this.options.languages,function(i,v){if(v===language)return result=!0,!1}),result},initializeLanguage:function(language,features){this.options.languages.push(language);features.codeAction&&this._codeAction(language);features.completionItem&&this._completionItem(language);features.declaration&&this._declaration(language);features.definition&&this._definition(language);features.signatureHelp&&this._signatureHelp(language);features.documentSymbol&&this._documentSymbol(language);features.documentFormatting&&this._documentFormatting(language);features.codeLens&&this._codeLens(language)},setTargetProperty:function(property){this.options.property=property},_codeAction:function(language){var instance=this;monaco.languages.registerCodeActionProvider(language,{provideCodeActions:function(model,range,context){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideCodeActions",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},range:range,context:context,text:model.getValue()},onComplete:function(data){var edit,textEdit;if(data)for(let i=0;i<data.length;i++)if(edit=data[i].edit,edit)for(let j=0;j<edit.edits.length;j++)textEdit=edit.edits[j],textEdit.resource&&(textEdit.resource=monaco.Uri.parse(textEdit.resource));resolve({actions:data===null?[]:data,dispose:function(){data=null}})}},!1)}catch(e){reject();console.log(e)}})}})},_completionItem:function(language){var instance=this;monaco.languages.registerCompletionItemProvider(language,{provideCompletionItems:function(model,position,context){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideCompletionItems",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},position:position,context:context,text:model.getValue()},onComplete:function(data){data?(data.dispose=function(){data=null},resolve(data)):reject()}},!1)}catch(e){reject();console.log(e)}})}})},_declaration:function(language){var instance=this;monaco.languages.registerDeclarationProvider(language,{provideDeclaration:function(model,position){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideDeclaration",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},position:position,text:model.getValue()},onComplete:function(data){resolve({uri:monaco.Uri.parse(data.uri),range:data.range})}},!1)}catch(e){reject();console.log(e)}})}})},_definition:function(language){var instance=this;monaco.languages.registerDefinitionProvider(language,{provideDefinition:function(model,position){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideDefinition",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},position:position,text:model.getValue()},onComplete:function(data){if(!data||!data.uri){resolve();return}var uri=monaco.Uri.parse(data.uri),model=monaco.editor.getModel(uri);model===null?ide.designerAction({data:{action:"loadModel",model:{uri:uri.toString()}},onComplete:e=>{var model=monaco.editor.createModel(e.text,e.language,uri.toString());model.fileName=e.fileName;model.microService=e.microService;textEditorState.isLanguageInitialized(e.language)||textEditorState.initializeLanguage(e.language,{codeAction:e.codeAction,completionItem:e.codeCompletion,declaration:e.declaration,definition:e.definition,signatureHelp:e.signatureHelp,documentSymbol:e.documentSymbol});resolve({uri:uri,range:data.range})}}):resolve({uri:uri,range:data.range})}},!1)}catch(e){reject();console.log(e)}})}})},_signatureHelp:function(language){var instance=this;monaco.languages.registerSignatureHelpProvider(language,{provideSignatureHelp:function(model,position){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideSignatureHelp",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},position:position,text:model.getValue()},onComplete:function(data){data?resolve({value:data,dispose:function(){data=null}}):reject()}},!1)}catch(e){reject();console.log(e)}})}})},_documentSymbol:function(language){var instance=this;monaco.languages.registerDocumentSymbolProvider(language,{provideDocumentSymbols:function(model){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideDocumentSymbols",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},text:model.getValue()},onComplete:function(data){data?resolve(data):reject()}},!1)}catch(e){reject();console.log(e)}})}})},_documentFormatting:function(language){var instance=this;monaco.languages.registerDocumentFormattingEditProvider(language,{provideDocumentFormattingEdits:function(model){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideDocumentFormattingEdits",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},text:model.getValue()},onComplete:function(data){data?resolve(data):reject()}},!1)}catch(e){reject();console.log(e)}})}})},_codeLens:function(language){var instance=this;monaco.languages.registerCodeLensProvider(language,{provideCodeLenses:function(model){return new Promise(function(resolve,reject){try{ide.designerAction({data:{action:"provideCodeLens",section:"designer",property:instance.options.property,model:{id:model.id,uri:model.uri.toString(),version:model._versionId},text:model.getValue()},onComplete:function(data){data?resolve({lenses:data,dispose:()=>{}}):resolve()}},!1)}catch(e){reject();console.log(e)}})}})},activateModel:function(id,fileName,ms){var tab,color;let models=monaco.editor.getModels();if(tab=$(`span[data-model="${id}"]`),tab.length===0){color=null;for(let i=0;i<this.options.colors.length;i++){let cl=this.options.colors[i];if(cl.ms===ms){color=cl.color;break}}if(color===null)for(let i=0;i<this.options.colors.length;i++){let cl=this.options.colors[i];if(cl.ms===null){cl.ms=ms;color=cl;break}}color===null&&(color=this.options.colors[0]);$("#modelTabs").append(`<span class="model-tab" data-model="${id}" style="background-color:${color.color}" title="${ms}">${fileName}</span>`)}for(let i=0;i<models.length;i++){let model=models[i];if(model.id===id){$("span[data-model]").removeClass("active");$(`span[data-model="${id}"]`).addClass("active");this.options.instance.setModel(model);break}}},closeModel:function(id){let models=monaco.editor.getModels();if(!(models.length<2))for(let i=0;i<models.length;i++){let model=models[i];if(model.id===id){model.dispose();$(`span[data-model="${id}"]`).remove();i===0?this.activateModel(models[1].id):this.activateModel(models[i-1].id);break}}}})}(jQuery);